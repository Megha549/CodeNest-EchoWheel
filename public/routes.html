<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wheelchair Accessible Route | EchoWheel</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map {
      height: 90vh;
      width: 100%;
    }
    body {
      font-family: Arial, sans-serif;
      padding: 0;
      margin: 0;
    }
    button {
      margin: 10px;
      padding: 10px;
    }
  </style>
</head>

<body>
    <div class="sidebar" id="sidebar">
  <h2>ðŸ¦½ EchoWheel</h2>
  <nav>
    <ul>
      <li><a href="dashboard.html" class="active">Dashboard</a></li>
      <li><a href="patient-form.html">Patient Info</a></li>
      <li><a href="medication.html">Medication</a></li>
      <li><a href="logs.html">Emergency Logs</a></li>
      <li><a href="qr.html">QR Health ID</a></li>
      <li><a href="routes.html">Routes</a></li>
      <li><a href="settings.html">Settings</a></li>
    </ul>
  </nav>
</div>
  <h2 style="text-align:center;">â™¿ Accessible Route Finder (OpenRouteService)</h2>
  <div id="map"></div>
  <script>
    const map = L.map('map').setView([28.6139, 77.2090], 13); // Default to Delhi

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let startMarker, endMarker, routeLayer;

    const orsApiKey =  "AIzaSyCPp8Prk6x29L5tXp7nK9OUq1PE5dhIpyM";

    map.on('click', async (e) => {
      if (!startMarker) {
        startMarker = L.marker(e.latlng).addTo(map).bindPopup("Start").openPopup();
      } else if (!endMarker) {
        endMarker = L.marker(e.latlng).addTo(map).bindPopup("Destination").openPopup();
        await getRoute(startMarker.getLatLng(), endMarker.getLatLng());
      } else {
        map.removeLayer(startMarker);
        map.removeLayer(endMarker);
        if (routeLayer) map.removeLayer(routeLayer);
        startMarker = endMarker = null;
      }
    });

    async function getRoute(start, end) {
      const url = 'https://api.openrouteservice.org/v2/directions/wheelchair';
      const body = {
        coordinates: [
          [start.lng, start.lat],
          [end.lng, end.lat]
        ]
      };

      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Authorization': orsApiKey,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      });

      const data = await response.json();
      const coords = data.features[0].geometry.coordinates.map(c => [c[1], c[0]]);

      routeLayer = L.polyline(coords, { color: 'blue', weight: 5 }).addTo(map);
      map.fitBounds(routeLayer.getBounds());
    }
  </script>
</body>

</html>